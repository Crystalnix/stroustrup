<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
    <title>Test coverage report: book_library.forms</title>
    <style type="text/css" media="screen">
      a
      {
        color: #3d707a;
      }
      
      a:hover, a:active
      {
        color: #bf7d18;
      }
    
      body 
      {
        font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif;
        font-size: 13px;
      }
      
      .nav 
      {
        font-size: 12px;
        margin-left: 50px;
      }

      .ignored
      {
        color: #707070;
      }

      .executed 
      {
        color: #3d9900;
      }

      .missed 
      {
        color: red;
        font-weight: bold;
      }

      .excluded 
      {
        color: #6090f0;
        font-weight: lighter;
      }
    
      #content-header 
      {
        font-size: 12px;
        padding: 18px 0 18px 50px;
      }

      #content-header h1 
      {
        font-size: 16px;
        margin: 10px 0 0 0;
        color: #909090;
      }
      
      #module-name
      {
        color: #583707;
      }
    
      #content-header p
      {
        font-size: 13px;
        margin: 0;
        color: #909090;
      }

      #content-header .normal 
      {
        color: #609030;
      }

      #content-header .warning 
      {
        color: #d0a000;
      }

      #content-header .critical 
      {
        color: red;
      }
      
      #source-listing 
      {
        margin-bottom: 24px;
      }

      #source-listing ol 
      {
        padding: 0 0 0 50px;
        width: 90%;
        font-family: monospace;
        list-style-position: outside;
      }

      #source-listing ol li 
      {
        line-height: 18px;
        font-size: small;
      }
        
      #source-listing ol code 
      {
        padding:  0 .001em 0 0; /* Firefox doesn't render empty li's properly */
        font-size: medium;
        white-space: pre;
      }
   </style>
  </head>

  <body>

<div class="nav">
  <a href="book_library.admin.html">book_library.admin</a> &lt;&lt;
  <a href="../index.html">index</a>
  &gt;&gt; <a href="book_library.management.commands._private.html">book_library.management.commands._private</a>
</div>

<div id="content-header">
  <h1>
    <span id="module-name">book_library.forms</span>:
    176 total statements,
    <span class="critical">47.0% covered</span>
  </h1>
  <p>Generated: Fri 2014-03-21 15:36 OMST</p>
  <p>Source file: /Users/romanusynin/PycharmProjects/stroustrup/book_library/forms.py</p>
  <p>
    Stats:
    <span class="executed">79 executed</span>,
    <span class="missed">89 missed</span>,
    <span class="excluded">8 excluded</span>,
    <span class="ignored">70 ignored</span> 
  </p> 
</div>

<div id="source-listing">
  <ol>
    <li class="excluded"><code>from urllib2 import urlopen</code></li>
<li class="excluded"><code>from django.forms import ModelForm</code></li>
<li class="excluded"><code>from django import forms</code></li>
<li class="excluded"><code>from django.core.exceptions import ValidationError</code></li>
<li class="excluded"><code>from crispy_forms.helper import FormHelper</code></li>
<li class="excluded"><code>from crispy_forms.layout import Layout, Submit, Field</code></li>
<li class="excluded"><code>from crispy_forms.bootstrap import PrependedText, InlineField</code></li>
<li class="excluded"><code>from book_library.models import Book, Book_Tag, Author, Book_Request, Book_Comment, Book_Rating</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class NameField(forms.CharField):</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def to_python(self, value):</code></li>
<li class="missed"><code>        if value:</code></li>
<li class="missed"><code>            value = value.split(',')</code></li>
<li class="missed"><code>            value = [tuple(x.split(None, 2)) for x in value if len(tuple(x.split())) &gt; 1]</code></li>
<li class="missed"><code>        return value</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def validate(self, value):</code></li>
<li class="missed"><code>        if not value:</code></li>
<li class="missed"><code>            raise ValidationError(["Enter first name and last name with namespace. "</code></li>
<li class="ignored"><code>                                   "Every author should be separated by comma from another author. "</code></li>
<li class="ignored"><code>                                   "Probably you wrote single (last or first) name."])</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class TagField(forms.CharField):</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def to_python(self, value):</code></li>
<li class="missed"><code>        if value:</code></li>
<li class="missed"><code>            value = value.split(',')</code></li>
<li class="missed"><code>        return value</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class BookForm(ModelForm):</code></li>
<li class="executed"><code>    authors_names = NameField(max_length=100, label="Add authors full names (to separate use a comma):")</code></li>
<li class="executed"><code>    tag_field = TagField(max_length=50, label='Add tags (to separate use a comma):', required=False)</code></li>
<li class="executed"><code>    e_version_exists = forms.BooleanField(label='E-version', required=False)</code></li>
<li class="executed"><code>    paperback_version_exists = forms.BooleanField(label='Paper version', required=False)</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    helper = FormHelper()</code></li>
<li class="executed"><code>    helper.form_class = 'form-group'</code></li>
<li class="executed"><code>    helper.layout = Layout(PrependedText('isbn', '13 digits'),</code></li>
<li class="ignored"><code>                           Field('title', css_class='form-control'),</code></li>
<li class="ignored"><code>                           Field('e_version_exists', css_class='form-group'),</code></li>
<li class="ignored"><code>                           Field('paperback_version_exists', css_class='form-group'),</code></li>
<li class="ignored"><code>                           Field('description', rows="3", css_class='form-control'),</code></li>
<li class="ignored"><code>                           Field('picture', css_class='form-control'),</code></li>
<li class="ignored"><code>                           Field('book_file', css_class='form-control'),</code></li>
<li class="ignored"><code>                           Field('authors_names', css_class='form-control'),</code></li>
<li class="ignored"><code>                           Field('tag_field', css_class='form-group'),</code></li>
<li class="ignored"><code>                           Submit('save_changes', 'Save', css_class='btn btn-lg btn-block btn-success form-group'))</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def clean_isbn(self):</code></li>
<li class="missed"><code>        data = self.cleaned_data['isbn']</code></li>
<li class="missed"><code>        if data == '':</code></li>
<li class="missed"><code>            return data</code></li>
<li class="missed"><code>        try:</code></li>
<li class="missed"><code>            Book.books.get(isbn=data)</code></li>
<li class="missed"><code>        except Book.DoesNotExist:</code></li>
<li class="missed"><code>            return data</code></li>
<li class="missed"><code>        raise forms.ValidationError('This ISBN is already taken.')</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def clean(self):</code></li>
<li class="missed"><code>        cleaned_data = self.cleaned_data</code></li>
<li class="missed"><code>        e_version_exists = self.cleaned_data['e_version_exists']</code></li>
<li class="missed"><code>        if 'book_file' in cleaned_data:</code></li>
<li class="missed"><code>            file_book = cleaned_data['book_file']</code></li>
<li class="ignored"><code>        else:</code></li>
<li class="missed"><code>            return cleaned_data</code></li>
<li class="missed"><code>        if e_version_exists and (file_book is None):</code></li>
<li class="missed"><code>            msg = 'You selected "E-version" but did not select a file.'</code></li>
<li class="missed"><code>            self._errors['book_file'] = self.error_class([msg])</code></li>
<li class="missed"><code>            del cleaned_data['book_file']</code></li>
<li class="missed"><code>        if e_version_exists is False and (file_book is not None):</code></li>
<li class="missed"><code>            msg = 'You selected a file but did not select "E-version".'</code></li>
<li class="missed"><code>            self._errors['book_file'] = self.error_class([msg])</code></li>
<li class="missed"><code>            del cleaned_data['book_file']</code></li>
<li class="missed"><code>        return cleaned_data</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    class Meta:</code></li>
<li class="executed"><code>        model = Book</code></li>
<li class="executed"><code>        exclude = ['busy', 'users', 'authors', 'tags', 'book_rating', 'comments']</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def save(self, commit=True):</code></li>
<li class="missed"><code>        authors = self.cleaned_data['authors_names']</code></li>
<li class="missed"><code>        tags = self.cleaned_data['tag_field']</code></li>
<li class="missed"><code>        book = super(BookForm, self).save(commit)</code></li>
<li class="missed"><code>        book.authors.clear()</code></li>
<li class="missed"><code>        book.tags.clear()</code></li>
<li class="missed"><code>        for author in authors:</code></li>
<li class="ignored"><code>        # all inputs checks to belong to db</code></li>
<li class="ignored"><code>        # if such input not exists then it creates</code></li>
<li class="ignored"><code>        # otherwise - it just becomes book's one</code></li>
<li class="missed"><code>            fname = author[0]</code></li>
<li class="missed"><code>            lname = author[1]</code></li>
<li class="missed"><code>            new_author = None</code></li>
<li class="missed"><code>            flag = False</code></li>
<li class="missed"><code>            for _author in Author.authors.all():</code></li>
<li class="missed"><code>                if _author.first_name == fname and _author.last_name == lname:</code></li>
<li class="missed"><code>                    new_author = _author</code></li>
<li class="missed"><code>                    flag = True</code></li>
<li class="missed"><code>                    break</code></li>
<li class="missed"><code>            if not flag:</code></li>
<li class="missed"><code>                new_author, created = Author.authors.get_or_create(first_name=author[0], last_name=author[1])</code></li>
<li class="missed"><code>            book.authors.add(new_author)</code></li>
<li class="missed"><code>        for _tag in tags:</code></li>
<li class="ignored"><code>        #as same as authors</code></li>
<li class="missed"><code>            new_tag = None</code></li>
<li class="missed"><code>            flag = False</code></li>
<li class="missed"><code>            for el in Book_Tag.tags.all():</code></li>
<li class="missed"><code>                if el.tag == _tag:</code></li>
<li class="missed"><code>                    flag = True</code></li>
<li class="missed"><code>                    new_tag = el</code></li>
<li class="missed"><code>                    break</code></li>
<li class="missed"><code>            if not flag:</code></li>
<li class="missed"><code>                new_tag, created = Book_Tag.tags.get_or_create(tag=_tag)</code></li>
<li class="missed"><code>            book.tags.add(new_tag)</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>        return book</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class Book_TagForm(ModelForm):</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    class Meta:</code></li>
<li class="executed"><code>        model = Book_Tag</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class AuthorForm(ModelForm):</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    class Meta:</code></li>
<li class="executed"><code>        model = Author</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class SureForm(forms.Form):</code></li>
<li class="executed"><code>    confirm = forms.BooleanField(label='Are you sure?', required=False)</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class SearchForm(forms.Form):</code></li>
<li class="executed"><code>    busy = forms.BooleanField(label='Busy', required=False)</code></li>
<li class="executed"><code>    free = forms.BooleanField(label='Free', required=False)</code></li>
<li class="executed"><code>    keywords = forms.CharField(label='Search', max_length=45)</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    helper = FormHelper()</code></li>
<li class="executed"><code>    helper.form_method = 'get'</code></li>
<li class="executed"><code>    helper.form_class = "form-inline"</code></li>
<li class="executed"><code>    helper.form_id = "search_form"</code></li>
<li class="executed"><code>    helper.field_template = 'bootstrap3/layout/inline_field.html'</code></li>
<li class="executed"><code>    helper.form_show_labels = False</code></li>
<li class="executed"><code>    helper.layout = Layout(InlineField('busy', css_class="search_box"),</code></li>
<li class="ignored"><code>                           InlineField('free', css_class="search_box"),</code></li>
<li class="ignored"><code>                           InlineField('keywords', wrapper_class="col-xs-5"),</code></li>
<li class="ignored"><code>                           Submit('search', 'Search', css_class="btn btn-default"))</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class Book_UpdateForm(BookForm):</code></li>
<li class="executed"><code>        def __init__(self, *args, **kwargs):</code></li>
<li class="missed"><code>            kwargs.setdefault('initial', {})['authors'] = ''</code></li>
<li class="missed"><code>            super(BookForm, self).__init__(*args, **kwargs)</code></li>
<li class="missed"><code>            if not self.is_bound and self.instance.pk:</code></li>
<li class="missed"><code>                queryset_authors = self.instance.authors.all()</code></li>
<li class="missed"><code>                authors = u", ".join(unicode(v) for v in queryset_authors)</code></li>
<li class="missed"><code>                self.fields['authors_names'].initial = authors</code></li>
<li class="missed"><code>                queryset_tags = self.instance.tags.all()</code></li>
<li class="missed"><code>                tags = u",".join(unicode(v) for v in queryset_tags)</code></li>
<li class="missed"><code>                self.fields['tag_field'].initial = tags</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>        def clean_isbn(self):</code></li>
<li class="missed"><code>            data = self.cleaned_data['isbn']</code></li>
<li class="missed"><code>            if data == '' or self.instance.isbn == data:</code></li>
<li class="missed"><code>                return data</code></li>
<li class="missed"><code>            try:</code></li>
<li class="missed"><code>                Book.books.get(isbn=data)</code></li>
<li class="missed"><code>            except Book.DoesNotExist:</code></li>
<li class="missed"><code>                return data</code></li>
<li class="ignored"><code>            else:</code></li>
<li class="missed"><code>                raise forms.ValidationError('This ISBN is already taken.')</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class Book_RequestForm(ModelForm): #SpaT_edition</code></li>
<li class="executed"><code>    title = forms.CharField(widget=forms.TextInput(attrs={'placeholder': 'Title'}))</code></li>
<li class="executed"><code>    url = forms.URLField(widget=forms.TextInput(attrs={'placeholder': 'Paste URL here'}))</code></li>
<li class="executed"><code>    helper = FormHelper()</code></li>
<li class="executed"><code>    helper.form_method = 'post'</code></li>
<li class="executed"><code>    helper.form_class = "form-group row"</code></li>
<li class="executed"><code>    helper.form_show_labels = False</code></li>
<li class="executed"><code>    helper.error_text_inline = True</code></li>
<li class="executed"><code>    helper.field_template = 'bootstrap3/layout/inline_field.html'</code></li>
<li class="executed"><code>    helper.layout = Layout(Field('title', wrapper_class="col-xs-5"),</code></li>
<li class="ignored"><code>                           Field('url', wrapper_class="col-xs-5"),</code></li>
<li class="ignored"><code>                           Submit('send', 'Send!', css_class="btn  btn-success col-md-2"))</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    class Meta:</code></li>
<li class="executed"><code>        model = Book_Request</code></li>
<li class="executed"><code>        fields = ['title', 'url']</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def clean_url(self):</code></li>
<li class="missed"><code>        try:</code></li>
<li class="missed"><code>            urlopen(self.cleaned_data['url'])</code></li>
<li class="missed"><code>        except:</code></li>
<li class="missed"><code>            raise forms.ValidationError('This URL is not available.')</code></li>
<li class="missed"><code>        return self.cleaned_data['url']</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def save(self, commit=True):   #Probably it's became useless</code></li>
<li class="missed"><code>        if self.cleaned_data['url'] and self.cleaned_data['title']:</code></li>
<li class="missed"><code>            _url = self.cleaned_data['url']</code></li>
<li class="missed"><code>            _title = self.cleaned_data['title']</code></li>
<li class="missed"><code>            req = Book_Request.requests.create(url=_url, title=_title)</code></li>
<li class="missed"><code>            return req</code></li>
<li class="ignored"><code>        else:</code></li>
<li class="missed"><code>            return super(Book_RequestForm, self).save(commit=True)</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class Book_RatingForm(ModelForm):</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    class Meta:</code></li>
<li class="executed"><code>        model = Book_Rating</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class Book_CommentForm(ModelForm):</code></li>
<li class="executed"><code>    comment = forms.CharField(widget=forms.Textarea())</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    class Meta:</code></li>
<li class="executed"><code>        model = Book_Comment</code></li>
<li class="executed"><code>        fields = ['comment']</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    helper = FormHelper()</code></li>
<li class="executed"><code>    helper.form_method = 'post'</code></li>
<li class="executed"><code>    helper.form_class = "form-group"</code></li>
<li class="executed"><code>    helper.form_show_labels = False</code></li>
<li class="executed"><code>    helper.error_text_inline = True</code></li>
<li class="executed"><code>    helper.field_template = 'bootstrap3/layout/inline_field.html'</code></li>
<li class="executed"><code>    helper.layout = Layout(Field('comment', rows="4", css_class='form-control'),</code></li>
<li class="ignored"><code>                           Submit('send', 'Send!', css_class="btn  btn-success"))</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class PrintQRcodesForm(forms.Form):</code></li>
<li class="executed"><code>    books = forms.ModelMultipleChoiceField(queryset=Book.books.all(), widget=forms.CheckboxSelectMultiple)</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    helper = FormHelper()</code></li>
<li class="executed"><code>    helper.form_method = 'post'</code></li>
<li class="executed"><code>    helper.form_class = "form-group"</code></li>
<li class="executed"><code>    helper.form_show_labels = False</code></li>
<li class="executed"><code>    helper.error_text_inline = True</code></li>
<li class="executed"><code>    helper.layout = Layout(Field('books', wrapper_class="form-group"),</code></li>
<li class="ignored"><code>                           Submit('print', 'Print!', css_class="btn btn-lg btn-block btn-success form-group"))</code></li>
<li class="ignored"><code></code></li>
  </ol>
</div>

<div class="nav">
  <a href="book_library.admin.html">book_library.admin</a> &lt;&lt;
  <a href="../index.html">index</a>
  &gt;&gt; <a href="book_library.management.commands._private.html">book_library.management.commands._private</a>
</div>

  </body>
</html>

